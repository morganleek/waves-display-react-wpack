{"version":3,"sources":["webpack:///./src/js/api/chart.js","webpack:///./src/js/api/buoys.js","webpack:///./src/js/memplot/Memplot.js","webpack:///./src/js/api/memplots.js","webpack:///./src/js/chart/ChartDownloadModal.js","webpack:///./src/js/chart/Chart.js","webpack:///./src/js/map/Map.js","webpack:///./src/js/index.js","webpack:///external \"jQuery\""],"names":["parseFloatOr","floatVal","altVal","isNaN","parseFloat","reverseRotation","rotation","intVal","reversed","parseInt","windSpeedToKnots","speed","Math","floor","wadGetMod","max","length","mod","ceil","wadGenerateChartData","waves","includes","multiplier","MAX_ARROW_LIMIT","tp","sst","bottomTemp","hsig","chartLabels","dataPoints","generateDataPoints","forEach","wave","i","time","push","data","x","y","tpdeg","tm","tmdeg","dpspr","dmspr","windspeed","winddirect","currentMag","currentDir","startTime","min","map","endTime","startTimeRounded","endTimeRounded","maxWaveHeight","maxPeakPeriod","maxTemp","minTemp","mBaseFormat","mStart","DateTime","fromMillis","mEnd","scaleLabel","toFormat","timeRange","labels","datasets","hasItem","Object","entries","key","hasOwnProperty","axes","chartStyles","axesStyles","waveHeightAxes","peakPeriodAxes","tempAxes","windSpeedAxes","title","text","ticks","callback","tickValue","index","value","isMobile","window","innerWidth","display","position","config","type","options","responsive","aspectRatio","wadGetAspectRatio","hoverMode","stacked","plugins","fontSize","fontStyle","fontFamily","padding","lineHeight","fontColor","scales","legend","boxWidth","tooltips","callbacks","label","wadTempToolTip","timeLabel","wadRawDataToChartData","processed","data_points","JSON","parse","e","console","error","SyntaxError","tooltipItem","datasetIndex","otherIndex","firstValue","round","yLabel","secondValue","firstLabel","secondLabel","arrowImageOrange","Image","src","wad","plugin","arrowImageBlue","description","backgroundColor","borderColor","borderWidth","lineTension","pointRadius","fill","yAxisID","hidden","pointStyle","showLine","sizing","ratios","desktop","tablet","mobileLandscape","mobilePortrait","getBuoys","fetch","ajax","method","then","response","ok","Error","statusText","json","require","Memplot","props","state","loading","this","loadMemplots","prevProps","startDate","endDate","buoyId","init","getMemplots","getTime","setState","content","memplotsList","slice","reverse","item","memplotId","id","className","Component","MemplotImage","path","loadMemplot","getMemplot","width","height","classNames","ChartDownloadModal","close","download","downloadEnabled","downloadRequiresDetails","license","downloadButton","onClick","downloadForm","tabindex","aria-labelledby","aria-label","ChartDownloadUserForm","formik","useFormik","initialValues","fullName","company","country","howWillYou","howWillYouOther","howDidYou","howDidYouOther","validate","values","errors","indexOf","onSubmit","setSubmitting","form_data","stringify","user_data_nonce","log","handleSubmit","class","htmlFor","name","onChange","handleChange","touched","placeholder","Charts","buoys","buoyFocus","document","querySelector","scrollIntoView","block","chartsLoopRender","row","is_enabled","buoyLabel","web_display_name","buoyLastUpdated","last_update","buoyLat","lat","buoyLng","lng","buoyDescription","buoyDownloadText","download_text","updateCenter","updateZoom","download_enabled","download_requires_details","Chart","isExpanded","dateRange","needsUpdating","downloadPath","handleModalClose","bind","handleDownloadClick","center","getBuoyByDate","success","Date","location","gtag","getBuoy","chartModal","chartTable","buttonGroup","chartBuoyDetails","chartGraph","expandedLabel","handleDateChanged","keys","chartGraphTemp","dataset","j","datasetClone","currentY","currentScales","optionsClone","unshift","lastUpdated","handleExportClick","handleExpandClick","handleCentreClick","selectsRange","update","customInput","ChartDatePicker","dateFormat","ref","React","createRef","expanded","data-buoy-id","forwardRef","ChartTable","active","lineTableRender","last","dateTime","showItem","obs_table_fields","biggest","reduce","prev","current","hasRecentData","lastTime","now","ChartPhoto","getBuoyImage","containerStyle","Map","polyline","marker","newCenter","panTo","setZoom","updateFocus","infoWindow","visible","buoyDownloadWindow","icon","url","labelOrigin","google","maps","Point","scaledSize","Size","anchor","decommissionedIcon","labelIcon","setBounds","currentZoom","getZoom","newState","historicData","target","checked","liveData","setTimeout","boundsSet","initBoundsSet","minLat","minLng","maxLat","maxLng","fitBounds","east","west","north","south","markers","polylines","polylineTimes","polylineMarkers","focus","live","buoy_display_init_current","historic","buoy_display_init_historic","zoom","bounds","element","drifting","isEnabled","start_date","end_date","getDriftingBuoys","pathTimes","polyLineTime","newMarkers","currentDay","getDate","n","pathDate","toString","padStart","getMonth","getFullYear","driftingMarker","polylineFocus","onMapPolylineClick","geodesic","strokeColor","strokeOpacity","strokeWeight","clickable","cluster","polylineLabels","gridSize","maxZoom","clusterer","markerFocus","onMapMarkerClick","onMapDecommissionedMarkerClick","info","sDate","eDate","closeBoxURL","enableEventPropagation","onCloseClick","onCloseInfoWindow","style","opacity","toDateString","href","onInfoWindowDownload","historicKey","undefined","buoy_display_key","onHistoricChange","onLiveChange","mapRender","googleMapsApiKey","googleApiKey","mapContainerStyle","styles","mapStyles","onLoad","onBoundsChanged","onZoomChanged","MapMarker","children","MapPolyline","App","googleLat","googleLng","updateMapCenter","updateMapZoom","newZoom","addEventListener","event","getElementsByClassName","ReactDOM","getElementById","render","closeNews","preventDefault","news","classList","add","module","exports","jQuery"],"mappings":"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","file":"app/main-05767254.js","sourcesContent":["import $ from 'jquery';\nimport Chart from 'chart.js/auto';\nimport chartStyles from './chart-style.json';\nimport { DateTime } from 'luxon'; \n\n// Tool for parsing Ints\nfunction parseIntOr( intVal, altVal ) {\n\tif( isNaN( parseInt( intVal ) ) ) {\n\t\tif( !isNaN( parseInt( altVal ) ) ) {\n\t\t\treturn altVal;\n\t\t}\n\t\treturn 0;\n\t}\n\treturn parseInt( intVal );\n}\n\n// Tool for parse Floats\nfunction parseFloatOr( floatVal, altVal ) {\n\tif( isNaN( parseFloat( floatVal ) ) ) {\n\t\tif( !isNaN( parseFloat( altVal ) ) ) {\n\t\t\treturn altVal;\n\t\t}\n\t\treturn 0.0;\n\t}\n\treturn parseFloat( floatVal );\n}\n\n// Reverse rotation\nfunction reverseRotation( rotation ) {\n\tconst reversed = parseIntOr( rotation, 0 ); \n\treturn ( reversed < 0 ) ? 0 : ( reversed + 180 ) % 360;\n}\n\n// Wind speed to knots\nfunction windSpeedToKnots( speed ) {\n\treturn Math.floor( speed * 1.944 * 10 ) / 10;\n}\n\n// Get mod for max number of elements\nfunction wadGetMod( max, length ) {\n\tconst mod = Math.ceil( length / max );\n\treturn ( mod >= 1 ) ? mod : 1;\n}\n\n// Process and sort data and push into chart\nexport function wadGenerateChartData( waves, includes, multiplier = 1 ) {\n\tconst MAX_ARROW_LIMIT = 60;\n\n\tif( !includes ) {\n\t\t// Ordering \n\t\tincludes = {\n\t\t\ttp: true,\n\t\t\tsst: true, \n\t\t\tbottomTemp: true,\n\t\t\thsig: true,\n\t\t};\n\t}\n\n\tif( typeof( waves ) != \"undefined\" && waves.length > 0 ) {\n\t\tlet chartLabels = [];\n\t\tlet dataPoints = generateDataPoints( includes );\n\n\t\t// Check again MAX_ARROW_LIMIT\n\t\tconst mod = wadGetMod( MAX_ARROW_LIMIT, waves.length );\n\n\t\t// Loop\n\t\twaves.forEach( ( wave, i ) => {\n\t\t\t// Time as moment object with offset\n\t\t\tconst time = parseInt( wave['Time (UNIX/UTC)'] ) * 1000; // moment.unix( parseInt( wave.time ) ); // .utcOffset( buoyOffset );\n\t\t\tchartLabels.push( time );\n\n\t\t\t// Has quality data\n\t\t\tif( wave[\"QF_waves\"] == \"1\" ) {\n\t\t\t\t// Values\n\t\t\t\tif( parseFloatOr( wave[\"Hsig (m)\"], -1 ) > 0 ) {\n\t\t\t\t\tdataPoints.hsig.data.push( { x: time, y: parseFloatOr( wave[\"Hsig (m)\"], 0.0 ) } );\n\t\t\t\t}\n\t\t\t\t// Peak\n\t\t\t\tif( parseFloatOr( wave[\"Tp (s)\"], -1 ) > 0 ) {\n\t\t\t\t\tif( i % mod == 0 ) { // Reduce to every nth item according to MAX_ARROW_LIMIT\n\t\t\t\t\t\tdataPoints.tp.data.push( { x: time, y: parseFloatOr( wave[\"Tp (s)\"], 0.0 ) } );\n\t\t\t\t\t\tdataPoints.tp.rotation.push( reverseRotation( wave[\"Dp (deg)\"] ) );\n\t\t\t\t\t\tdataPoints.tpdeg.data.push( { x: time, y: wave[\"Dp (deg)\"] } );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Mean\n\t\t\t\tif( parseFloatOr( wave[\"Tm (s)\"], -1 ) > 0 ) {\n\t\t\t\t\tif( i % mod == 0 ) { // Reduce to every nth item according to MAX_ARROW_LIMIT\n\t\t\t\t\t\tdataPoints.tm.data.push( { x: time, y: parseFloatOr( wave[\"Tm (s)\"], 0.0 ) } );\n\t\t\t\t\t\tdataPoints.tm.rotation.push( reverseRotation( wave[\"Dm (deg)\"] ) );\n\t\t\t\t\t\tdataPoints.tmdeg.data.push( { x: time, y: wave[\"Dm (deg)\"] } );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Spread\n\t\t\t\tif( parseFloatOr( wave[\"DpSpr (deg)\"], -1 ) > 0 ) {\n\t\t\t\t\tdataPoints.dpspr.data.push( { x: time, y: parseFloatOr( wave[\"DpSpr (deg)\"], 0.0 ) } );\n\t\t\t\t}\n\t\t\t\tif( parseFloatOr( wave[\"DmSpr (deg)\"], -1 ) > 0 ) {\n\t\t\t\t\tdataPoints.dmspr.data.push( { x: time, y: parseFloatOr( wave[\"DmSpr (deg)\"], 0.0 ) } );\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( !isNaN( wave[\"SST (degC)\"] ) && wave[\"QF_sst\"] == \"1\" ) {\n\t\t\t\tdataPoints.sst.data.push( { x: time, y: parseFloatOr( wave[\"SST (degC)\"], 0.0 ) } );\n\t\t\t}\n\t\t\tif( !isNaN( wave[\"Bottom Temp (degC)\"] ) && wave[\"QF_bott_temp\"] == \"1\") {\n\t\t\t\tdataPoints.bottomTemp.data.push( { x: time, y: parseFloatOr( wave[\"Bottom Temp (degC)\"], 0.0 ) } );\n\t\t\t}\n\t\t\tdataPoints.windspeed.data.push( { x: time, y: windSpeedToKnots( parseFloatOr( wave[\"WindSpeed (m/s)\"], 0.0 ) ) } );\n\t\t\tdataPoints.windspeed.rotation.push( parseFloatOr( wave[\"WindDirec (deg)\"], 0.0 ) );\n\t\t\tdataPoints.winddirect.data.push( { x: time, y: parseFloatOr( wave[\"WindDirec (deg)\"], 0.0 ) } );\n\t\t\t// Only want last value\n\t\t\tdataPoints.currentMag.data = [{ x: time, y: parseFloatOr( wave[\"CurrmentMag (m/s)\"], 0.0 ) }];\n\t\t\tdataPoints.currentDir.data = [{ x: time, y: parseFloatOr( wave[\"CurrentDir (deg) \"], 0.0 ) }];\n\t\t} );\n\t\t\n\t\tconst startTime = Math.min(...waves.map( ( wave ) => wave['Time (UNIX/UTC)'] ) ) * 1000;\n\t\tconst endTime = Math.max(...waves.map( ( wave ) => wave['Time (UNIX/UTC)'] ) ) * 1000;\n\t\tconst startTimeRounded = ( Math.ceil( startTime / 3600000 ) + 1 ) * 3600000;\n\t\tconst endTimeRounded = ( Math.ceil( endTime / 3600000 ) + 1 ) * 3600000;\n\t\t\n\t\tconst maxWaveHeight = Math.ceil( Math.max( ...dataPoints.hsig.data.map( ( wave ) => wave.y ) ) );\n\t\tconst maxPeakPeriod = Math.ceil( Math.max( ...dataPoints.tp.data.map( ( wave )  => wave.y ) ) );\n\t\tconst minPeakPeriod = Math.floor( Math.min( ...dataPoints.tp.data.map( ( wave )  => wave.y ) ) );\n\t\t// const minPeakPeriodSpaced = ( maxPeakPeriod - ( ( maxPeakPeriod - minPeakPeriod ) * 2 ) );\n\t\tconst maxTemp = Math.ceil( Math.max( ...dataPoints.sst.data.map( ( wave ) => wave.y ), ...dataPoints.bottomTemp.data.map( ( wave ) => wave.y ) ) );\n\t\tconst minTemp = Math.floor( Math.min( ...dataPoints.sst.data.map( ( wave ) => wave.y ), ...dataPoints.bottomTemp.data.map( ( wave ) => wave.y ) ) );\n\n\t\tconst mBaseFormat = 'dd LLL y h:mma';\n\t\tconst mStart = DateTime.fromMillis( startTimeRounded );\n\t\tconst mEnd = DateTime.fromMillis( endTimeRounded );\n\t\tconst scaleLabel = mStart.toFormat( mBaseFormat ) + \" — \" + mEnd.toFormat( mBaseFormat );\n\t\tconst timeRange = [ mStart.toFormat( 'x' ), mEnd.toFormat( 'x' ) ];\n\n\t\t// Data\n\t\tvar data = {\n\t\t\tlabels: chartLabels,\n\t\t\tdatasets: []\n\t\t};\n\n\t\tlet hasItem = {};\n\n\t\t// Add each item specified\n\t\tfor (const [key, value] of Object.entries( includes )) {\n\t\t\tif( dataPoints.hasOwnProperty( key ) && dataPoints[key].data.length > 0 ) {\n\t\t\t\thasItem[key] = true;\n\t\t\t\tdata.datasets.push( dataPoints[key] ); \n\t\t\t}\n\t\t}\n\t\t\n\t\t// Axes'\n\t\tconst axes = {};\n\t\t// Import styles\n\t\tconst { x, waveHeightAxes, peakPeriodAxes, tempAxes, windSpeedAxes } = chartStyles.axesStyles;\n\n\t\t// X Axis\n\t\tx.title.text = scaleLabel;\n\t\tx.ticks.callback = ( tickValue, index, ticks ) => {\n\t\t\treturn [\n\t\t\t\tDateTime.fromMillis( ticks[index].value ).toFormat( \"d LLL\" ),\n\t\t\t\tDateTime.fromMillis( ticks[index].value ).toFormat( \"HH:MM\" )\n\t\t\t];\n\t\t};\n\t\taxes.x = x;\n\n\t\tconst isMobile = ( window.innerWidth < 768 ) ? false : true; // Screen size\n\t\t\n\t\t// Y Axes\n\t\tif( hasItem.hasOwnProperty( 'hsig' ) ) {\n\t\t\t// Wave Height Axes\n\t\t\twaveHeightAxes.ticks.max = ( Math.ceil( maxWaveHeight ) > 2 ) ? Math.ceil( maxWaveHeight ) : 2; \n\t\t\twaveHeightAxes.title.display = isMobile;\n\t\t\taxes[\"y-axis-1\"] = waveHeightAxes;\n\t\t}\n\t\t\n\t\tif( hasItem.hasOwnProperty( 'tp' ) ) {\n\t\t\t// Peak Period Axes\n\t\t\tpeakPeriodAxes.ticks.min = 0;\n\t\t\tpeakPeriodAxes.ticks.max = ( maxPeakPeriod < 25 ) ? 25 : Math.ceil( maxPeakPeriod / 2 ) * 2;\n\t\t\tpeakPeriodAxes.title.display = isMobile;\n\t\t\tpeakPeriodAxes.position = ( axes[\"y-axis-1\"] ) ? 'right' : 'left';\n\t\t\taxes[\"y-axis-2\"] = peakPeriodAxes;\n\t\t}\n\n\t\tif( hasItem.hasOwnProperty( 'sst' ) || hasItem.hasOwnProperty( 'bottomTemp' ) ) {\n\t\t\t// Temp Axes\n\t\t\ttempAxes.ticks.min = minTemp - 1;\n\t\t\ttempAxes.ticks.max = maxTemp + 1;\n\t\t\ttempAxes.title.display = isMobile;\n\t\t\ttempAxes.position = ( axes[\"y-axis-1\"] ) ? 'right' : 'left';\n\t\t\taxes[\"y-axis-3\"] = tempAxes;\n\t\t}\n\n\t\tif( hasItem.hasOwnProperty( 'windspeed' ) ) {\n\t\t\t// Peak Period Axes\n\t\t\taxes[\"y-axis-4\"] = windSpeedAxes;\n\t\t}\n\n\t\t// const sizing = ( window.innerWidth >= 992 ) ? 'desktop' : ( window.innerWidth >= 768 ) ? 'tablet' : ( window.innerWidth >= 450 ) ? 'mobileLandscape' : 'mobilePortrait';\n\t\t// const ratios = {\n\t\t// \tdesktop: 2 / multiplier,\n\t\t// \ttablet: 2 / multiplier,\n\t\t// \tmobileLandscape: 1.75,\n\t\t// \tmobilePortrait: 1.5,\n\t\t// };\n\t\t\n\t\t// Draw Chart\n\t\tvar config = {\n\t\t\ttype: 'line',\n\t\t\tdata: data,\n\t\t\toptions: {\n\t\t\t\tresponsive: true,\n\t\t\t\taspectRatio: wadGetAspectRatio( multiplier ),\n\t\t\t\thoverMode: 'index',\n\t\t\t\tstacked: false,\n\t\t\t\t// animation: false,\n\t\t\t\tplugins: {\n\t\t\t\t\ttitle: {\n\t\t\t\t\t\tdisplay: true,\n\t\t\t\t\t\ttext: 'Click legend labels to toggle their appearance',\n\t\t\t\t\t\tfontSize: 10,\n\t\t\t\t\t\tfontStyle: 'normal',\n\t\t\t\t\t\tfontFamily: \"'Lato', sans-serif\",\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\tlineHeight: 1.1,\n\t\t\t\t\t\tfontColor: '#989898'\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tscales: axes,\n\t\t\t\tlegend: {\n\t\t\t\t\tdisplay: false,\n\t\t\t\t\tlabels: {\n\t\t\t\t\t\tboxWidth: 15,\n\t\t\t\t\t\tfontColor: '#000000'\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttooltips: {\n\t\t\t\t\tcallbacks: {\n\t\t\t\t\t\tlabel: wadTempToolTip \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn { config: config, dataPoints: dataPoints, timeLabel: scaleLabel, timeRange: timeRange };\n\t}\n\treturn false;\n} \n\n// Draw Latest Data into a table\n// export function wadDrawLatestTable( buoyId, dataPoints ) {\n// \t//\n// \t// Make work with new draw method\n// \t//\n// \tlet buoyInfoHtml = \"\";\n\t\n// \tfor( const [key, value] of Object.entries( dataPoints ) ) {\n// \t\t// Show only if wanted\n// \t\tif( value.showInChart ) {\n// \t\t\t// Max value\n// \t\t\tconst recent = value.data[0];\n\t\t\t\n// \t\t\tif( typeof( recent ) != \"undefined\" ) {\n// \t\t\t\tlet recentValue;\n\t\t\t\t\n// \t\t\t\tswitch ( typeof( recent ) ) {\n// \t\t\t\t\tcase \"object\": // { x, y }\n// \t\t\t\t\t\tif( recent.hasOwnProperty( 'y' ) && recent.y > 0 ) {\n// \t\t\t\t\t\t\trecentValue = recent.y;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t\tbreak;\n// \t\t\t\t\tcase \"number\": // y - direction values\n// \t\t\t\t\t\trecentValue = ( recent + 180 ) % 360;\n// \t\t\t\t\t\t// recentValue = recent;\n// \t\t\t\t\tdefault:\n// \t\t\t\t\t\tbreak;\n// \t\t\t\t}\n\t\t\t\t\n// \t\t\t\t// Append value to table\n// \t\t\t\tif( recentValue ) {\n// \t\t\t\t\tbuoyInfoHtml += \"<li>\" + value.description + \n// \t\t\t\t\t\t\"<span class='value'>\" + recentValue + \"</span></li>\";\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t}\n\t\n// \tconst buoyWrapper = document.getElementById( 'buoy-' + buoyId );\n// \t// Time\n// \tlet time = \"\";\n// \tif( window.buoysData != undefined && window.buoysData.has( parseInt( buoyId ) ) ) {\n// \t\tconst lastUpdate = moment( window.buoysData.get( parseInt( buoyId ) ).last_update * 1000 );\n// \t\tconst queryTime = moment( window.buoysData.get( parseInt( buoyId ) ).now * 1000 );\n\t\t\n// \t\tconst timeDiff = queryTime.diff( lastUpdate, 'hours' );\n// \t\tconst hasWarning = ( timeDiff >= 3 ) ? true : false;\n// \t\tconst formattedTime = ( timeDiff >= 3 ) ? lastUpdate.format( 'h:mma DD/MM/YYYY' ) + ' (' + timeDiff + ' hours ago)' : lastUpdate.format( 'h:mma DD/MM/YYYY' );\n\n// \t\tconst latestObservations = buoyWrapper.getElementsByClassName( 'latest-observations' )[0];\n// \t\tlatestObservations.getElementsByTagName( 'time' )[0].innerHTML = formattedTime;\n// \t\tlatestObservations.getElementsByTagName( 'time' )[0].classList.toggle( 'warning', hasWarning );\n// \t}\n\n// \t// Clear it\n// \tconst chartInfo = buoyWrapper.getElementsByClassName(\"chart-info\")[0];\n// \tchartInfo.innerHTML = \"\";\n// \tchartInfo.insertAdjacentHTML( 'afterbegin', \"<ul>\" + buoyInfoHtml + \"</ul>\" );\n// \tchartInfo.addEventListener( 'click', wadToggleChart );\n// }\n\n// Render Heading for Buoy Chart\nexport function wadDrawHeading( buoyId, label, range ) {\n\tconst buoyWrapper = document.getElementById( 'buoy-' + buoyId );\n\tconst panelHeading = buoyWrapper.getElementsByClassName( 'card-header' )\n\tif( panelHeading.length > 0 ) {\n\t\t// Download time range\n\t\tconst downloadTrigger = panelHeading[0].getElementsByClassName( 'download-trigger' );\n\t\tif( downloadTrigger.length > 0 ) {\n\t\t\tdownloadTrigger[0].dataset['start'] = range[0];\n\t\t\tdownloadTrigger[0].dataset['end'] = range[1];\n\t\t}\n\t\tif( window.myPickers != undefined ) {\n\t\t\twindow.myPickers['buoy' + buoyId].options.startDate.dateInstance = ( new Date( parseInt( range[0] ) ) );\n\t\t\twindow.myPickers['buoy' + buoyId].options.endDate.dateInstance = ( new Date( parseInt( range[1] ) ) );\n\t\t}\n\t\t\n\t\tconst dateRangeButton = panelHeading[0].getElementsByClassName( 'dateRangeButtonLabel' );\n\t\tif( dateRangeButton.length > 0 ) {\n\t\t\tdateRangeButton[0].innerHTML = label;\n\t\t}\n\t}\n}\n\n// Render Chart\nexport function wadDrawChart( config, canvasContext ) {\n\tif( canvasContext ) {\n\t\treturn new Chart( canvasContext, config );\n\t}\n\treturn;\n}\n\n// Render custom chart toggles\nexport function wadDrawChartLegend( buoyId, config ) {\n\tlet labels = [];\n\n\t// Label and Buoy\n\tif( config.data.datasets ) {\n\t\tconst buoyCanvasLegend = document.querySelector( \"#buoy-\" + buoyId + \" .canvas-legend\" );\n\t\t\n\t\tif( buoyCanvasLegend ) {\n\t\t\tbuoyCanvasLegend.innerHTML = \"\";\n\t\t\tconfig.data.datasets.forEach( ( legend, i ) => {\n\t\t\t\tconst checkbox = document.createElement( 'input' );\n\t\t\t\tcheckbox.id = 'legend-toggle-' + buoyId + '-' + i;\n\t\t\t\tcheckbox.type = \"checkbox\";\n\t\t\t\tcheckbox.checked = ( typeof( legend ) != \"undefined\" && typeof( legend.hidden ) != \"undefined\" ) ? !legend.hidden : true;\n\t\t\t\tcheckbox.dataset.buoyId = buoyId;\n\t\t\t\tcheckbox.dataset.legendItem = i;\n\t\t\t\tcheckbox.style.setProperty( '--checkbox-background', legend.backgroundColor );\n\t\t\t\tcheckbox.addEventListener( 'click', wadLegendToggle );\n\n\t\t\t\tconst labelSpan = document.createElement( 'span' );\n\t\t\t\tlabelSpan.innerHTML = legend.label;\n\n\t\t\t\tconst label = document.createElement( 'label' );\n\t\t\t\t// label.innerHTML = legend.label;\n\t\t\t\tlabel.htmlFor = 'legend-toggle-' + buoyId + '-' + i;\n\n\t\t\t\t// Add checkbox to label\n\t\t\t\tlabel.insertAdjacentElement( 'afterbegin', labelSpan );\n\t\t\t\tlabel.insertAdjacentElement( 'afterbegin', checkbox );\n\t\t\t\t// Add label to legend\n\t\t\t\tbuoyCanvasLegend.insertAdjacentElement( 'beforeend', label );\n\t\t\t});\n\t\t}\n\t}\n}\n\n// Chart toggles event\nfunction wadLegendToggle( e ) {\n\tconst buoyId = e.target.dataset[\"buoyId\"];\n\tconst legendItem = e.target.dataset[\"legendItem\"];\n\tif( myCharts.hasOwnProperty( \"buoy\" + buoyId ) ) {\n\t\tmyCharts[\"buoy\" + buoyId].getDatasetMeta( legendItem ).hidden = !e.target.checked;\n\t\tmyCharts[\"buoy\" + buoyId].update();\n\t}\n}\n\n// Get memplots\nexport function wadProcessMemplots( response ) {\n\tif( response ) {\n\t\tif( response.data.length > 0 ) {\n\t\t\t// Three most recent\n\t\t\t// const buoy = response.data.slice(-3);\n\t\t\t// Most recent\n\t\t\tconst buoy = response.data.slice(-1);\n\t\t\tfor( let i = 0; i < buoy.length; i++ ) {\n\t\t\t\t// Fetch memplot path\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\turl: wad.ajax,\n\t\t\t\t\tdata: { \n\t\t\t\t\t\taction: 'waf_get_file_path',\n\t\t\t\t\t\tid: buoy[i].id,\n\t\t\t\t\t\tbuoy_id: buoy[i].buoy_id\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: wadProcessMemplot,\n\t\t\t\t\tdataType: 'json'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction wadProcessMemplot( response ) {\n\tif( response ) {\n\t\tconst image = new Image();\n\t\timage.src = response.path;\n\t\tdocument.querySelector( \"#buoy-\" + response.buoy_id + \" .memplot\" ).appendChild( image );\n\t}\n}\n\n// Convert Array of JSON values to Objects\nexport function wadRawDataToChartData( data ) {\n  let processed = [];\n  if( data.length > 0 ) {\n    for( let i = 0; i < data.length; i++ ) {\n      if( data[i].data_points ) {\n        try {\n          processed.push( JSON.parse( data[i].data_points ) );\n        } catch( e ) {\n          console.error(e instanceof SyntaxError);\n        }\n      }\n    }\n  }\n\n  return processed;\n}\n\n// Combining Temp Tooltips\nfunction wadTempToolTip( tooltipItem, data ) {\n  if( ( tooltipItem.datasetIndex == 2 || tooltipItem.datasetIndex == 3 ) && data.datasets.hasOwnProperty( 3 ) ) {\n    // Temp data and Bottom Temp Exists\n    const otherIndex = ( tooltipItem.datasetIndex == 2 ) ? 3 : 2;\n    const firstValue = Math.round(tooltipItem.yLabel * 100) / 100;\n    const secondValue = Math.round(data.datasets[otherIndex].data[tooltipItem.index].y * 100) / 100;\n    if( firstValue != secondValue ) {\n      let firstLabel = data.datasets[tooltipItem.datasetIndex].label || '';\n      let secondLabel = data.datasets[otherIndex].label || '';\n      firstLabel = ( firstLabel ) ? firstLabel + ': ' + firstValue : firstValue;\n      secondLabel = ( secondLabel ) ? secondLabel + ': ' + secondValue : secondValue;\n      return [ firstLabel, secondLabel ];\n    }\n  }\n  // Everything else\n  var label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n  if (label) {\n    label += ': ';\n  }\n  label += Math.round(tooltipItem.yLabel * 100) / 100;\n  return label;\n}\n\n// Appearance for each datapoint type\nexport function generateDataPoints( includes ) {\n\t// Arrows\n\tlet arrowImageOrange = new Image( 28, 28 );\n\tarrowImageOrange.src = wad.plugin + \"images/arrow-grad-orange@2x.png\";\n\tlet arrowImageBlue = new Image( 28, 28 );\n\tarrowImageBlue.src = wad.plugin + \"images/arrow-blue-g@2x.png\";\n\tlet arrowImagePink = new Image( 28, 28 );\n\tarrowImagePink.src = wad.plugin + \"images/arrow-pink-g@2x.png\";\n\t\n\t// Datapoint setup\n\tlet dataPoints = {\n\t\thsig: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tlabel: window.innerWidth >= 768 ? 'Significant Wave Height (m)' : 'Sig Wave (m)',\n\t\t\tdescription: \"Significant Wave Height (m)\",\n\t\t\tbackgroundColor: 'rgba(165, 223, 223, 0.4)',\n\t\t\tborderColor: 'rgba(75, 192, 192, 1)',\n\t\t\tborderWidth: 1,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 1,\n\t\t\tfill: true,\n\t\t\tyAxisID: 'y-axis-1',\n\t\t\thidden: ( includes.hasOwnProperty( 'hsig' ) ) ? !includes.hsig : true\n\t\t}, \n\t\ttp: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tlabel: window.innerWidth >= 768 ? 'Peak Wave Period & Direction (s & deg)' : 'Peak Wave/Dir (s & deg)',\n\t\t\tdescription: \"Peak Wave Period (s)\",\n\t\t\tbackgroundColor: 'rgba(237, 135, 80, 1)',\n\t\t\tborderColor: 'rgba(235, 127, 74, 0.5)',\n\t\t\tborderWidth: 0,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 35,\n\t\t\tpointStyle: arrowImageOrange,\n\t\t\trotation: [],\n\t\t\tfill: false,\n\t\t\tyAxisID: 'y-axis-2',\n\t\t\tshowLine: false,\n\t\t\thidden: ( includes.hasOwnProperty( 'tp' ) ) ? !includes.tp : true\n\t\t}, \n\t\ttm: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Mean Wave Period (s)\",\n\t\t\tlabel: window.innerWidth >= 768 ? 'Mean Wave Period & Direction (s & deg)' : 'Mean Wave/Dir (s & deg)', // Peak Period (s)\n\t\t\tbackgroundColor: 'rgba(77, 168, 248, 0.7)',\n\t\t\tborderColor: 'rgba(77, 168, 248, 0.5)',\n\t\t\tborderWidth: 0,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 35,\n\t\t\tpointStyle: arrowImageBlue,\n\t\t\trotation: [],\n\t\t\tfill: false,\n\t\t\tyAxisID: 'y-axis-2',\n\t\t\thidden: ( includes.hasOwnProperty( 'tm' ) ) ? !includes.tm : true\n\t\t}, \n\t\ttpdeg: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tdescription: \"Peak Wave Direction (deg)\",\n\t\t}, \n\t\ttmdeg: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Mean Wave Direction (deg)\",\n\t\t},\n\t\tdpspr: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tdescription: \"Peak Wave Spreading (deg)\",\n\t\t}, \n\t\tdmspr: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Mean Wave Spreading (deg)\",\n\t\t},\n\t\tsst: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tdescription: \"Sea Surface Temperature (degC)\",\n\t\t\tlabel: window.innerWidth >= 768 ? 'Sea Surface Temperature (°C)' : 'Sea Surf (°C)', \n\t\t\tbackgroundColor: 'rgba(194, 59, 34, 1)',\n\t\t\tborderColor: 'rgba(194, 59, 34, 1)',\n\t\t\tborderWidth: 1,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 1,\n\t\t\tfill: false,\n\t\t\tyAxisID: 'y-axis-3',\n\t\t\thidden: ( includes.hasOwnProperty( 'sst' ) ) ? !includes.sst : true\n\t\t},\n\t\tbottomTemp: { \n\t\t\tdata: [], \n\t\t\t// showInChart: true, \n\t\t\tdescription: \"Sea Bottom Temperature (degC)\",\n\t\t\tlabel: window.innerWidth ? 'Bottom Temperature (°C)' : 'Bot Temp (°C)',\n\t\t\tbackgroundColor: 'rgb(255, 159, 64, 0.5)',\n\t\t\tborderColor: 'rgb(255, 159, 64, 1)',\n\t\t\tborderWidth: 1,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 1,\n\t\t\tfill: false,\n\t\t\tyAxisID: 'y-axis-3',\n\t\t\thidden: ( includes.hasOwnProperty( 'bottomTemp' ) ) ? !includes.bottomTemp : true\n\t\t},\n\t\twindspeed: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Wind Speed (knots)\",\n\t\t\tlabel: window.innerWidth >= 768 ? 'Wind Speed (knots)' : 'Wind Spd (knts)',\n\t\t\tbackgroundColor: 'rgba(77, 168, 248, 0.7)',\n\t\t\tborderColor: 'rgba(77, 168, 248, 0.5)',\n\t\t\tborderWidth: 0,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 35,\n\t\t\tpointStyle: arrowImageBlue,\n\t\t\trotation: [], // winddirec\n\t\t\tfill: false,\n\t\t\tyAxisID: 'y-axis-1',\n\t\t\thidden: ( includes.hasOwnProperty( 'windspeed' ) ) ? !includes.windspeed : true\n\t\t},\n\t\twinddirect: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Wind Direction (deg)\",\n\t\t},\n\t\tcurrentMag: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Current Mag (m/s)\",\n\t\t\tlabel: \"Current Mag (m/s)\",\n\t\t\tbackgroundColor: 'rgba(165, 223, 223, 1)',\n\t\t\tborderColor: 'rgba(75, 192, 192, 1)',\n\t\t\tborderWidth: 0,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 2,\n\t\t\tfill: true,\n\t\t\tyAxisID: 'y-axis-1',\n\t\t},\n\t\tcurrentDir: { \n\t\t\tdata: [], \n\t\t\t// showInChart: false, \n\t\t\tdescription: \"Current Direction (deg)\",\n\t\t\tlabel: window.innerWidth >= 768 ? \"Current Direction (m/s)\" : \"Current Dir (m/s)\",\n\t\t\tbackgroundColor: 'rgba(165, 223, 223, 1)',\n\t\t\tborderColor: 'rgba(75, 192, 192, 1)',\n\t\t\tborderWidth: 0,\n\t\t\tlineTension: 0,\n\t\t\tpointRadius: 2,\n\t\t\tfill: true,\n\t\t\tyAxisID: 'y-axis-1',\n\t\t},\n\t\t// qfWaves: { data: [], showInChart: false, description: \"\" }, \n\t\t// qfSst: [], \n\t\t// qfBottTemp: [], \n\t};\n\n\treturn dataPoints;\n}\n\n// export const panelWrapper = \"<div class='card card-primary mb-3'>\" +\n//   \"<div class='card-header'>\" +\n// \t\t\"<h6 class='pull-left text-white'>{{ buoyLabel }} <span style='opacity: 0.35;'>#{{ buoyId }}</span><time></time></h6>\" + \n// \t\t\"<div class='btn-group chart-js-menu pull-right' role='group' aria-label='Chart Tools'>\" + \n// \t\t\t\"<button class='expand-trigger btn btn-outline-secondary' data-buoy-id='{{ buoyId }}'><i class='fa fa-expand' aria-hidden='true'></i>&nbsp;&nbsp;Expand</button>\" +\n// \t\t\t\"<button class='maps-trigger btn btn-outline-secondary' data-buoy-id='{{ buoyId }}' data-buoy-lat='{{ buoyLat }}' data-buoy-lng='{{ buoyLng }}'><i class='fa fa-crosshairs' aria-hidden='true'></i>&nbsp;&nbsp;Centre</button>\" +\n// \t\t\t\"<button class='download-trigger btn btn-outline-secondary' data-buoy-id='{{ buoyId }}'><i class='fa fa-floppy-o' aria-hidden='true'></i>&nbsp;&nbsp;Export Data</button>\" +\n// \t\t\t\"<button class='calendars-trigger btn btn-outline-secondary' data-buoy-id='{{ buoyId }}' data-buoy-start='{{ buoyStartTime }}' data-buoy-end='{{ buoyEndTime }}'><i class='fa fa-calendar' aria-hidden='true'></i>&nbsp;&nbsp;<span class='dateRangeButtonLabel'>Date Range</span> <i class='fa fa-caret-down' aria-hidden='true'></i></button>\" +\n// \t\t\"</div>\" +\n// \t\"</div>\" + \n// \t\"<div class='card-body'>\" + \n// \t\t\"<div class='canvas-legend'></div>\" +\n//     \"<div class='canvas-wrapper loading'>\" +\n//       \"<canvas></canvas>\" +\n//     \"</div>\" +\n//     \"<h5 class='latest-observations'>Latest Observations <time></time></h5>\" +\n// \t\t\"<div class='buoy-description'>\" + \n// \t\t\t\"<div class='decription'></div>\" +\n// \t\t\t\"<div class='image'></div>\" +\n// \t\t\t\"<div class='memplot'></div>\" +\n// \t\t\"</div>\" + \n// \t\t\"<div class='chart-info'>\" + \n// \t\t\"</div>\" +\n//   \"</div>\" +\n// \"</div>\";\n\nexport const wadGetAspectRatio = ( multiplier = 1 ) => {\n\tconst sizing = ( window.innerWidth >= 992 ) ? 'desktop' : ( window.innerWidth >= 768 ) ? 'tablet' : ( window.innerWidth >= 450 ) ? 'mobileLandscape' : 'mobilePortrait';\n\tconst ratios = {\n\t\tdesktop: 2 / multiplier,\n\t\ttablet: 2 / multiplier,\n\t\tmobileLandscape: 1.75,\n\t\tmobilePortrait: 1.5,\n\t};\n\n\treturn ratios[sizing];\n}","export function getBuoys() {\n  if( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_rest_list_buoys\", init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        // console.log( response );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n\nexport function getBuoy( buoyId ) {\n  if( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_rest_list_buoy_datapoints&id=\" + buoyId, init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n\nexport function getBuoyByDate( buoyId, startDate, endDate ) {\n  if( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_rest_list_buoy_datapoints&id=\" + buoyId + \"&start=\" + startDate + \"&end=\" + endDate , init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n\nexport function getDriftingBuoys() {\n  if( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_rest_list_buoys_drifting\", init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        // console.log( response );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n\nexport function getBuoyImage( buoyId ) {\n\tif( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_get_buoy_image_path&buoy_id=\" + buoyId, init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}","\n\nimport { data } from \"jquery\";\nimport React, { Component, Fragment } from \"react\";\n\n// import { wadRawDataToChartData, wadGenerateChartData, wadGetAspectRatio } from '../api/chart';\nimport { getMemplots, getMemplot } from '../api/memplots';\n\nconst classNames = require('classnames');\n\nexport class Memplot extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      data: [],\n\t\t\tloading: true\n    }\n  }\n\n  componentDidMount() {\n\t\tthis.loadMemplots();\n  }\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { startDate, endDate } = this.props;\n\t\tif( startDate && endDate && prevProps.endDate == null ) {\n\t\t\t// Previous date is always null before a change\n\t\t\tthis.loadMemplots();\n\t\t}\n\t}\n\n\tloadMemplots() {\n\t\tif( this.props.buoyId ) {\n\t\t\tconst { startDate, endDate } = this.props;\n\t\t\t\n\t\t\tgetMemplots( this.props.buoyId, startDate.getTime() / 1000, endDate.getTime() / 1000 ).then( json => {\n\t\t\t  this.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t    data: json.data\n\t\t\t  } );\n\t\t\t} );\n\t\t}\n\t}\n\n\n  render() {\n\t\tconst { data, loading } = this.state;\n\t\tif( this.props.buoyId ) {\n\t\t\tlet content = <p>Loading &hellip;</p>;\n\t\t\tif( !loading ) {\n\t\t\t\tif( data.length > 0 ) {\n\t\t\t\t\tlet memplotsList = [];\n\t\t\t\t\t// console.log( data );\n\t\t\t\t\tconst memplotData = data.slice( 0, 5 ).reverse(); // Final 5 items\n\t\t\t\t\t\n\t\t\t\t\tmemplotData.forEach( ( item, i ) => {\n\t\t\t\t\t\t\n\t\t\t\t\t\tmemplotsList.push( <MemplotImage buoyId={ this.props.buoyId } memplotId={ item.id } key={ i } /> );\n\t\t\t\t\t} );\n\n\t\t\t\t\tcontent = memplotsList;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcontent = <p><em>No spectral data available for this time period</em></p>\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<div className=\"chart-memplot\">\n\t\t\t\t\t{ content }\t\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n    return (\n      <div className=\"chart-memplot\"><pre>No id set</pre></div>\n    );\n  }\n}\n\n// \nexport class MemplotImage extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      path: ''\n    }\n  }\n\n  componentDidMount() {\n\t\tthis.loadMemplot();\n  }\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { memplotId } = this.props;\n\t\tif( prevProps.memplotId != memplotId ) {\n\t\t\tthis.loadMemplot();\n\t\t}\n\t}\n\n\tloadMemplot() {\n\t\tif( this.props.buoyId && this.props.memplotId ) {\n\t\t\tgetMemplot( this.props.buoyId, this.props.memplotId ).then( json => {\t\n\t\t\t  this.setState( {\n\t\t\t    path: json.path\n\t\t\t  } );\n\t\t\t} );\t\n\t\t}\n\t}\n\n  render() {\n\t\tconst { path } = this.state;\n\n\t\tif( path.length == 0 ) {\n\t\t return <div className=\"memplot-placeholder\"></div>\n\t\t}\n\t\treturn <img src={ path } width=\"1230\" height=\"1082\" />\n  }\n}","export function getMemplots( buoyId, startDate = 0, endDate = 0 ) {\n\tif( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_rest_list_buoys_memplots&id=\" + buoyId + \"&start=\" + startDate + \"&end=\" + endDate, init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n\nexport function getMemplot( buoyId, memplotId ) {\n\tif( typeof( wad ) != \"undefined\" ) {\n    const init = {\n      method: 'POST'\n    }\n    return fetch( wad.ajax + \"?action=waf_get_file_path&buoy_id=\" + buoyId + \"&id=\" + memplotId, init ) \n      .then( response => {\n        if( !response.ok ) throw Error( response.statusText );\n        return response.json();\n      } )\n      .then( json => json );\n  }\n}\n","import React from \"react\";\nimport { useFormik } from 'formik';\nconst classNames = require('classnames');\n\n\nexport const ChartDownloadModal = ( { close, download, downloadEnabled, downloadRequiresDetails, title, license, buoyId } ) => {\n  const downloadButton = ( downloadEnabled && !downloadRequiresDetails ) ? <button type=\"button\" className={ classNames( 'btn', 'btn-primary', 'btn-download' ) } onClick={ download } >Download</button> : '';\n  const downloadForm = ( downloadRequiresDetails ) ? <ChartDownloadUserForm download={ download } buoyId={ buoyId }></ChartDownloadUserForm> : '';\n  return (\n    <div className={ classNames( 'modal', 'fade', 'show' ) } id=\"chartModal\" tabindex=\"-1\" aria-labelledby=\"chartModalLabel\" >\n      <div className={ classNames( 'modal-dialog' ) }>\n        <div className={ classNames( 'modal-content' ) }>\n          <div className={ classNames( 'modal-header' ) }>\n            <h5 className={ classNames( 'modal-title' ) } id=\"chartModalLabel\">{ title }</h5>\n            <button type=\"button\" className={ classNames( ['btn-close', 'fa', 'fa-close'] ) } aria-label=\"Close\" onClick={ close } ></button>\n          </div>\n          <div className={ classNames( 'modal-body' ) }>\n            <p>{ license }</p>\n            { downloadForm }\n          </div>\n          <div className={ classNames( 'modal-footer' ) }>\n            <button type=\"button\" className={ classNames( 'btn' , 'btn-secondary', 'btn-cancel' ) } onClick={ close } >Close</button>\n            { downloadButton }\n          </div>\n        </div>\n      </div>\n    </div>\n  ) \n};\n\nexport const ChartDownloadUserForm = ( { download, buoyId } ) => {\n  const formik = useFormik({\n    initialValues: {\n      fullName: '', \n      company: '', \n      state: '',\n      country: '',\n      howWillYou: '', \n      howWillYouOther: '',\n      howDidYou: '',\n      howDidYouOther: ''\n    },\n    validate: ( values ) => {\n      const errors = {};\n\n      // No empty fields allowed\n      for( const value in values ) {\n        if( !values[value] && value.indexOf('Other') == -1 ) {\n          errors[value] = \"Required\";\n        }\n      }\n\n      return errors;\n    },\n    onSubmit: ( values, { setSubmitting } ) => {\n      // Don't submit form\n      setSubmitting( false );\n      \n      // Send form data\n      const form_data = JSON.stringify( values, null, 2 );\n      const init = {\n        method: 'POST'\n      }\n      fetch( wad.ajax + \"?action=waf_collect_user_data&buoy_id=\" + buoyId + \"&nonce=\" + wad.user_data_nonce + \"&form_data=\" + form_data, init ) \n        .then( response => {\n          if( !response.ok ) throw Error( response.statusText );\n          console.log( 'Form submitted successfully' );\n        } );\n      \n      // Trigger download\n      download();\n\n    },\n  });\n\n  return (\n    <form id=\"chart-download-user-form\" onSubmit={formik.handleSubmit}>\n      <div class=\"form-group\">\n        <label htmlFor=\"fullName\">Full Name *</label><br />\n        <input \n          type=\"text\"\n          class=\"form-control\"\n          name=\"fullName\"\n          onChange={ formik.handleChange }\n          value={ formik.values.fullName } />\n        { formik.touched.fullName && formik.errors.fullName ? <div>{ formik.errors.fullName }</div> : null }\n      </div>\n      <div class=\"form-group\">\n        <label htmlFor=\"company\">Company *</label><br />\n        <input \n          type=\"text\"\n          class=\"form-control\"\n          name=\"company\"\n          onChange={ formik.handleChange }\n          value={ formik.values.company } />\n        { formik.touched.company && formik.errors.company ? <div>{ formik.errors.company }</div> : null }\n      </div>\n      <div class=\"form-group\">\n        <label htmlFor=\"state\">State/Provence *</label><br />\n        <input \n          type=\"text\"\n          class=\"form-control\"\n          name=\"state\"\n          onChange={ formik.handleChange }\n          value={ formik.values.state } />\n        { formik.touched.state && formik.errors.state ? <div>{ formik.errors.state }</div> : null }\n      </div>\n      <div class=\"form-group\">\n        <label htmlFor=\"country\">Country *</label><br />\n        <input \n          type=\"text\"\n          class=\"form-control\"\n          name=\"country\"\n          onChange={ formik.handleChange }\n          value={ formik.values.country } />\n        { formik.touched.country && formik.errors.country ? <div>{ formik.errors.country }</div> : null }\n      </div>\n      <div class=\"form-group\">\n        <label htmlFor=\"howWillYou\">How will you use the data: *</label>\n        <select \n          class=\"form-control\" \n          name=\"howWillYou\" \n          onChange={ formik.handleChange }\n          >\n          <option>&nbsp;</option>\n          <option value=\"education\">Education </option>\n          <option value=\"research\">Research </option>\n          <option value=\"recreation\">Recreation </option>\n          <option value=\"navigation\">Navigation </option>\n          <option value=\"other\">Other (specify)</option>\n        </select>\n        { formik.touched.howWillYou && formik.errors.howWillYou ? <div>{ formik.errors.howWillYou }</div> : null }\n        { formik.values.howWillYou == \"other\" ? ( \n          <input \n            type=\"text\"\n            class=\"form-control\"\n            name=\"howWillYouOther\"\n            onChange={ formik.handleChange }\n            placeholder=\"Please specify\"\n            value={ formik.values.howWillYouOther } />\n        ) : null }\n      </div>\n      <div class=\"form-group\">\n        <label htmlFor=\"howDidYou\">How did you hear about us: *</label>\n        <select \n          class=\"form-control\" \n          name=\"howDidYou\"\n          onChange={ formik.handleChange }\n          >\n          <option>&nbsp;</option>\n          <option value=\"social-media\">Social media</option>\n          <option value=\"web\">Web search</option>\n          <option value=\"news\">News</option>\n          <option value=\"email\">Email</option>\n          <option value=\"word\">Word of mouth</option>\n          <option value=\"other\">Other (specify)</option>\n        </select>\n        { formik.touched.howDidYou && formik.errors.howDidYou ? <div>{ formik.errors.howDidYou }</div> : null }\n        { formik.values.howDidYou == \"other\" ? (\n          <input \n            type=\"text\"\n            class=\"form-control\"\n            name=\"howDidYouOther\"\n            onChange={ formik.handleChange }\n            placeholder=\"Please specify\"\n            value={ formik.values.howDidYouOther } />\n        ) : null }\n      </div>\n      <button type=\"submit\" class=\"btn btn-primary\">Download</button>\n    </form>\n  )\n};","import React, { Component, Fragment, forwardRef, useState } from \"react\";\nimport { Line } from 'react-chartjs-2';\nimport DatePicker from \"react-datepicker\";\nimport { DateTime } from 'luxon'; \nimport 'chartjs-adapter-luxon';\n// import { DateTime } from 'luxon'; \n\nimport { wadRawDataToChartData, wadGenerateChartData, wadGetAspectRatio } from '../api/chart';\nimport { getBuoys, getBuoy, getBuoyByDate, getBuoyImage } from '../api/buoys';\n// import { getMemplot } from '../api/memplots';\nimport { Memplot } from '../memplot/Memplot';\nimport { ChartDownloadModal } from \"./ChartDownloadModal\";\n\nconst classNames = require('classnames');\n\nexport class Charts extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      buoys: [],\n    }\n  }\n\n  componentDidMount() {\n    getBuoys().then( json => {\n      this.setState( {\n        buoys: json\n      } );\n    } );\n  } \n\n  componentDidUpdate( prevProps ) {\n    const { buoyFocus } = this.props;\n    if( buoyFocus != prevProps.buoyFocus ) {\n      if( document.querySelector('[data-buoy-id=\"' + buoyFocus + '\"]') ) {\n        document.querySelector('[data-buoy-id=\"' + buoyFocus + '\"]').scrollIntoView( { block: \"start\" } );\n      }\n    }\n  }\n\n  render() {\n    const { buoys } = this.state;\n    let chartsLoopRender;\n    if( buoys.length > 0 ) {\n\t\t\tchartsLoopRender = buoys.map( ( row, index ) => {    \n        // <div className={ classNames( ['card', 'card-primary', 'mb-3'] ) } key={ index }> \n        if( parseInt( row.is_enabled ) == 1 ) {\n          return (\n            <Chart buoyId={ row.id } \n                  buoyLabel={ row.web_display_name } \n                  buoyLastUpdated={ row.last_update } \n                  buoyLat={ row.lat } \n                  buoyLng={ row.lng }\n                  buoyDescription={ row.description }\n                  buoyDownloadText={ row.download_text }\n                  updateCenter={ this.props.updateCenter }\n                  updateZoom={ this.props.updateZoom }\n                  downloadEnabled={ parseInt( row.download_enabled ) }\n                  downloadRequiresDetails={ parseInt( row.download_requires_details ) }\n                  key={ index }\n            />\n          )\n        }\n\t\t\t} );\n    }\n\n    return (\n      <div className=\"charts\">\n        <div>{ chartsLoopRender }</div>\n      </div>\n    );\n  }\n}\n\nfunction timeCallback( tickValue, index, ticks ) {\n  return tickValue.split(\" \");\n}\n\nexport class Chart extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      data: [],\n      isExpanded: false,\n      dateRange: [null, null],\n      needsUpdating: false,\n      downloadPath: ''\n\t\t}\n\n    this.handleModalClose = this.handleModalClose.bind( this );\n    this.handleDownloadClick = this.handleDownloadClick.bind( this );\n  }\n\n  handleExpandClick() {\n    this.setState( { isExpanded: !this.state.isExpanded } );\n  }\n\n\thandleCentreClick() {\n    const center = {\n      lat: parseFloat( this.props.buoyLat ),\n      lng: parseFloat( this.props.buoyLng )\n    };\n    this.props.updateCenter( center );\n    this.props.updateZoom( 10 );\n  }\n\n\thandleExportClick() {\n    const { buoyId } = this.props;\n    const { timeRange } = this.state.data;\n    if( timeRange.length == 2 ) {\n      const start = parseInt( timeRange[0] ) / 1000;\n      const end = parseInt( timeRange[1] ) / 1000;\n      const path = \"?action=waf_rest_list_buoy_datapoints_csv&id=\" + buoyId + \"&start=\" + start + \"&end=\" + end;\n      this.setState( { downloadPath: wad.ajax + path } );\n    }\n\t}\n\n\thandleDateChanged() {\n    const { dateRange } = this.state;\n    \n\t\tgetBuoyByDate( this.props.buoyId, dateRange[0].getTime() / 1000, dateRange[1].getTime() / 1000 ).then( json => {\n      if( json.success == 1 ) {\n        const data = wadGenerateChartData( wadRawDataToChartData( json.data ) );\n        this.setState( {\n          data: data,\n          dateRange: [ new Date( parseInt( data.timeRange[0] ) ), new Date( parseInt( data.timeRange[1] ) ) ]\n        } );\n      }      \n    } );\n\t}\n\n  handleDownloadClick() {\n    const { downloadPath } = this.state;\n    window.location = downloadPath;\n    this.setState( { downloadPath: '' } );\n    // Record in analytics\n    if( gtag ) {\n      gtag( 'event', 'csvExport', { 'method': downloadPath } );\n      // ga( 'send', 'event', 'ExportData', 'download', downloadPath );\n    }\n  }\n\n  handleModalClose() {\n    this.setState( { downloadPath: '' } );\n  }\n  \n  componentDidMount() {\n    getBuoy( this.props.buoyId ).then( json => {\n      if( json.success == 1 ) {\n        const data = wadGenerateChartData( wadRawDataToChartData( json.data ) );\n        this.setState( {\n          data: data,\n          dateRange: [ new Date( parseInt( data.timeRange[0] ) ), new Date( parseInt( data.timeRange[1] ) ) ],\n        } );\n        // const [startDate, setStartDate] = useState( 0 );\n      }      \n    } );\n  }\n  \n  render() {\n    let chartGraph = <p>Loading &hellip;</p>;\n    let chartModal, chartTable, buttonGroup, chartBuoyDetails, downloadButton;\n    const { data, isExpanded, dateRange, needsUpdating, downloadPath } = this.state;\n    const [ startDate, endDate ] = dateRange;\n    const expandedLabel = ( isExpanded ) ? 'Collapse' : 'Expand';\n    const { buoyLabel, downloadEnabled, downloadRequiresDetails } = this.props;\n    \n    if( startDate && endDate && needsUpdating ) {\n      this.setState( { needsUpdating: false } );\n      this.handleDateChanged();\n    }\n\t\t\n    if( Object.keys( data ).length > 0 ) {\n      if( isExpanded ) {\n        // Split apart\n        let chartGraphTemp = [];\n        \n        data.config.data.datasets.forEach( ( dataset, j ) => {\n          // Create dateset from grouped dataset\n          const datasetClone = { ...dataset };\n          datasetClone.hidden = false;\n          \n          // Create scales with only necessary ones\n          const currentY = datasetClone.yAxisID; // Current y-axis\n          const currentScales = {}; // New axis'\n          currentScales['x'] = { ...data.config.options.scales['x'] };\n          currentScales[currentY] = { ...data.config.options.scales[currentY] };\n          currentScales[currentY].position = \"left\"; // Make position left\n\n          // Clone options with updated options\n          const optionsClone = { ...data.config.options };\n          optionsClone.plugins = {} // Not legend title\n          optionsClone.aspectRatio = wadGetAspectRatio( 0.5 ); // Half aspect ratio\n          \n          // Assign\n          optionsClone.scales = currentScales;\n          \n          chartGraphTemp.unshift( \n            <Line \n              data={ { labels: data.config.data.labels, datasets: [ datasetClone ] } }  \n              options={ optionsClone } \n              key={ j } \n            /> \n          );\n        } );\n        chartGraph = chartGraphTemp;\n\n        // Expanded buoy details \n        chartBuoyDetails = <div className={ classNames( ['buoy-details'] ) }>\n          <ChartPhoto buoyId={ this.props.buoyId } />\n          <div className=\"chart-description\"><p>{ this.props.buoyDescription }</p></div>\n          <Memplot buoyId={ this.props.buoyId } startDate={ startDate } endDate={ endDate } />\n        </div>;\n      }\n      else {\n        // All in one\n        chartGraph = <Line data={ data.config.data } options={ data.config.options } />;\n      }\n\n      chartTable = <ChartTable dataPoints={ data.dataPoints } lastUpdated={ this.props.lastUpdated } />;\n      downloadButton = <button className={ classNames( ['btn', 'btn-outline-secondary' ] ) } onClick={ () => this.handleExportClick() } ><i className={ classNames( ['fa'], ['fa-floppy-o'] ) }></i> Export Data</button>;\n\t\t\tbuttonGroup = <div className={ classNames( ['btn-group', 'pull-right'] ) } >\n        <button className={ classNames( ['btn', 'btn-outline-secondary' ] ) } onClick={ () => this.handleExpandClick() }><i className={ classNames( ['fa'], ['fa-expand'] ) }></i> { expandedLabel }</button>\n\t\t\t\t<button className={ classNames( ['btn', 'btn-outline-secondary' ] ) } onClick={ () => this.handleCentreClick() }><i className={ classNames( ['fa'], ['fa-crosshairs'] ) }></i> Centre</button>\n\t\t\t\t{ downloadButton }\n\t\t\t\t<DatePicker\n          selectsRange={ true }\n          startDate={ startDate }\n          endDate={ endDate }\n          onChange={ ( update ) => {\n            this.setState( { dateRange: update } );\n            if( update[0] && update[1] ) {\n              this.setState( { needsUpdating: true } );\n            }\n          } }\n          customInput={ <ChartDatePicker /> }\n          dateFormat=\"dd/MM/yyyy\"\n        />\n\t\t\t</div>;\n\n\n      if( downloadPath.length > 0 ) {\n        const ref = React.createRef();\n        chartModal = <ChartDownloadModal \n          title=\"Terms and Conditions\"\n          buoyId={ this.props.buoyId }\n          license={ this.props.buoyDownloadText }\n          close={ this.handleModalClose }\n          download={ this.handleDownloadClick }\n          downloadEnabled={ downloadEnabled }\n          downloadRequiresDetails={ downloadRequiresDetails }\n          ref={ ref }\n        />;\n      }\n    }\n\n    return (\n      <div className={ classNames( ['card', 'card-primary', 'mb-3'], { expanded: isExpanded } ) } data-buoy-id={ this.props.buoyId } >\n        { chartModal }\n        <div className={ classNames( ['card-header', 'clearfix'] ) }>\n          <h6 className='pull-left'>{ buoyLabel }</h6>\n\t\t\t\t\t{ buttonGroup }\n        </div>\n        <div className='card-body'> \n          <div className={ classNames( ['canvas-wrapper', { 'is-updating': needsUpdating } ] ) }>\n\t\t\t\t\t\t{ chartGraph }\n            { chartBuoyDetails }\n            { chartTable }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\n// const ChartDownloadTrigger = forwardRef( ( props, ref ) => (\n//   <button className={ classNames( ['btn', 'btn-outline-secondary' ] ) } onClick={ () => this.handleExportClick() }>\n//     <i className={ classNames( ['fa'], ['fa-floppy-o'] ) }></i> Export Data\n//   </button>\n// ) );\n\nconst ChartDatePicker = forwardRef( ( { value, onClick }, ref ) => (\n  <button className={ classNames( ['btn', 'btn-outline-secondary', 'btn-datepicker' ] ) } onClick={ onClick } ref={ ref }>\n    <i className={ classNames( ['fa'], ['fa-calendar'] ) }></i> { value } <i className={ classNames( ['fa'], ['fa-caret-down'] ) }></i>\n  </button>\n) );\n\n// const ChartDownloadModal = ( props ) => <h1>Hello world!</h1>;\n// function ChartDownloadModal ( props ) {\n//   return <h1>{ props.license }</h1>;\n// } \n\n\n\nexport class ChartTable extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      active: false\n    }\n  }\n\n  render( ) {\n    // Iterate through chart table items\n    let lineTableRender = [];\n    let last = 0;\n    let dateTime = '';\n    // Each property\n    for( const [key, value] of Object.entries( this.props.dataPoints ) ) {\n      let showItem = true;\n      if( wad.obs_table_fields ) {\n        showItem = wad.obs_table_fields.indexOf( key ) >= 0;\n      }\n      \n      // Properties data length\n      if( showItem && value.data.length > 0 ) {\n        // Search for biggest date value (not ordered by date always)\n        const biggest = value.data.reduce( ( prev, current ) => {\n          return ( prev.x > current.x ) ? prev : current;\n        } );\n        \n        // Check is the lastest of all data points\n        if( biggest.x > last ) {\n          last = biggest.x;\n        }\n\n        // Check valid data  \n        if( biggest.y >= 0 ) {\n          lineTableRender.push( <li key={ key }>\n            { value.description }\n            <span>{ biggest.y }</span>\n          </li> );\n        }\n      }\n    }\n\n    // Create date string\n    let hasRecentData = false;\n    if( last > 0 ) {\n      const diff = 4 * 60 * 60 * 1000; // 4 hours\n      const lastTime = DateTime.fromMillis( last );\n      // Mark if last record is more than 4 hours\n      hasRecentData = last + diff > Date.now();\n      dateTime = <span className={ classNames( { \"recent-date\": hasRecentData, \"out-of-date\": !hasRecentData } ) }>{ lastTime.toFormat( 'd LLL y h:mma' ) }</span>\n    }\n\n    return (\n      <div className={ classNames( \"chart-info\", { \"expanded\": this.state.active } ) }\n        onClick={ () => this.setState( { active: !this.state.active } ) } >\n        <h5 className='latest-observations'>Latest Observations { dateTime }</h5>\n        <ul>{ lineTableRender }</ul>\n      </div>\n    );\n  }\n}\n\n// \nexport class ChartPhoto extends Component {\n  constructor( props ) {\n    super( props );\n    \n    this.state = {\n      path: ''\n    }\n  }\n\n  componentDidMount() {\n\t\tif( this.props.buoyId ) {\n\t\t\tgetBuoyImage( this.props.buoyId ).then( json => {\t\n\t\t\t  this.setState( {\n\t\t\t    path: json.path\n\t\t\t  } );\n\t\t\t} );\t\n\t\t}\n  }\n\n  render() {\n\t\tconst { path } = this.state;\n\n    let content = '';\n\t\tif( path.length == 0 ) {\n\t\t content = <div className=\"chart-photo-placeholder\"></div>\n\t\t}\n    else {\n      content = <img src={ path } />\n    }\n    return (\n      <div className=\"chart-image\">\n        { content }\n      </div>\n    )\n  }\n}","import React, { Component } from \"react\";\nimport { GoogleMap, LoadScript, MarkerClusterer, Marker, Polyline, InfoWindow } from '@react-google-maps/api';\n// import { GoogleMap, useLoadScript, MarkerClusterer, Marker, Polyline } from '@react-google-maps/api';\n\nimport { getBuoys, getDriftingBuoys } from '../api/buoys';\nimport { wadRawDataToChartData } from '../api/chart';\nimport { ChartDownloadModal } from \"../chart/ChartDownloadModal\";\n\nimport mapStyles from './map-style.json';\n\nconst containerStyle = {\n  width: '100%',\n  height: '100%'\n};\n\nexport class Map extends Component {\n\tconstructor( props ) {\n    super( props );\n    \n    this.state = {\n\t\t\tref: null,\n\t\t\tmarkers: [],\n\t\t\tpolylines: [],\n\t\t\tpolylineTimes: [],\n\t\t\tpolylineMarkers: [],\n\t\t\tminLat: 90,\n\t\t\tmaxLat: -90,\n\t\t\tminLng: 180,\n\t\t\tmaxLng: -180,\n\t\t\tboundsSet: false,\n\t\t\tinitBoundsSet: false,\n\t\t\ticon: '',\n\t\t\tlabelIcon: '',\n\t\t\tdecommissionedIcon: '',\n\t\t\tlabel: '',\n\t\t\tfocus: null,\n\t\t\thistoricData: false,\n\t\t\tliveData: true,\n\t\t\tbuoyDownloadWindow: false,\n\t\t\tbuoyDownloadText: '',\n\t\t\tdownloadPath: '',\n\t\t\tdownloadEnabled: true,\n\t\t\tcurrentZoom: 0,\n\t\t\tinfoWindow: {\n\t\t\t\tvisible: false,\n\t\t\t\tlat: 0.0,\n\t\t\t\tlng: 0.0,\n\t\t\t\tstartDate: '', \n\t\t\t\tendDate: '',\n\t\t\t\tcontent: ''\n\t\t\t}\n    }\n\n\t\tthis.handleModalClose = this.handleModalClose.bind( this );\n    this.handleDownloadClick = this.handleDownloadClick.bind( this );\n  }\n\n\t// Init\n\tcomponentDidMount() {\n\t\t// Check for Current and Historic Settings\n\t\tconst live = ( wad.buoy_display_init_current ) ? parseInt( wad.buoy_display_init_current ) : true;\n\t\tconst historic = ( wad.buoy_display_init_historic ) ? parseInt( wad.buoy_display_init_historic ) : false;\n\t\t// Zoom\n\t\tconst zoom = this.props.zoom;\n\t\t// Set stataes\n\t\tthis.setState( () => ( { liveData: live, historicData: historic, currentZoom: zoom } ) );\n\t\t// Get buoys\n    getBuoys().then( json => {\n\t\t\t// Bounds\n\t\t\tlet bounds = {\n\t\t\t\tminLat: 90,\n\t\t\t\tmaxLat: -90,\n\t\t\t\tminLng: 180,\n\t\t\t\tmaxLng: -180\n\t\t\t};\n\n\t\t\tif( json.length > 0 ) {\n\n\t\t\t\tjson.forEach( ( element, index ) => {\n\t\t\t\t\tif( parseInt( element.drifting ) == 0 ) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet marker = {\n\t\t\t\t\t\t\tbuoyId: element.id,\n\t\t\t\t\t\t\tlabel: element.web_display_name,\n\t\t\t\t\t\t\tlat: parseFloat( element.lat ),\n\t\t\t\t\t\t\tlng: parseFloat( element.lng ),\n\t\t\t\t\t\t\tisEnabled: parseInt( element.is_enabled ),\n\t\t\t\t\t\t\tbuoyDownloadText: element.download_text,\n\t\t\t\t\t\t\tdownloadPath: '',\n\t\t\t\t\t\t\tdownloadEnabled: parseInt( element.download_enabled ),\n\t\t\t\t\t\t\tdescription: element.description,\n\t\t\t\t\t\t\tstartDate: element.start_date,\n\t\t\t\t\t\t\tendDate: element.end_date\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Bounds\n\t\t\t\t\t\tbounds.minLat = ( bounds.minLat < marker.lat ) ? bounds.minLat : marker.lat;\n\t\t\t\t\t\tbounds.maxLat = ( bounds.maxLat > marker.lat ) ? bounds.maxLat : marker.lat;\n\t\t\t\t\t\tbounds.minLng = ( bounds.minLng < marker.lng ) ? bounds.minLng : marker.lng;\n\t\t\t\t\t\tbounds.maxLng = ( bounds.maxLng > marker.lng ) ? bounds.maxLng : marker.lng;\n\n\t\t\t\t\t\tthis.setState( ( state ) => ( { markers: [...state.markers, marker] } ) );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\t\n\t\t\tthis.setState( () => ( { minLat : bounds.minLat, maxLat : bounds.maxLat, minLng : bounds.minLng, maxLng : bounds.maxLng } ) );\n\n\t\t\tthis.setState( () => ( { boundsSet: true } ) );\n\t\t\tthis.setBounds();\n    } );\n\n\t\t// Get drifting\n\t\tgetDriftingBuoys().then( json => {\n\t\t\tif( json.length > 0 ) {\n\t\t\t\t// let driftingMap = json.map( ( row, index ) => {\n\t\t\t\tjson.forEach( ( element, index ) => {\n\n\t\t\t\t\tconst processed = wadRawDataToChartData( element.data );\n\t\t\t\t\t\n\t\t\t\t\tlet path = [];\n\t\t\t\t\tlet pathTimes = [];\n\t\t\t\t\t\n\t\t\t\t\tfor( let j = 0; j < processed.length; j++ ) {\n\t\t\t\t\t\tif( !isNaN( parseFloat( processed[j][\"Latitude (deg)\"] ) ) && !isNaN( parseFloat( processed[j][\"Longitude (deg) \"] ) ) ) {\n\t\t\t\t\t\t\tpath.push( { lat: parseFloat( processed[j][\"Latitude (deg)\"] ), lng: parseFloat( processed[j][\"Longitude (deg) \"] ) } );\n\t\t\t\t\t\t\tpathTimes.push( {\n\t\t\t\t\t\t\t\ttime: parseInt( processed[j]['Time (UNIX/UTC)'] ),\n\t\t\t\t\t\t\t\tlat: parseFloat( processed[j][\"Latitude (deg)\"] ), \n\t\t\t\t\t\t\t\tlng: parseFloat( processed[j][\"Longitude (deg) \"] )\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( path.length > 0 ) {\n\n\t\t\t\t\t\tconst polyLineTime = {\n\t\t\t\t\t\t\tbuoyId: element.id,\n\t\t\t\t\t\t\tisEnabled: parseInt( element.is_enabled ),\n\t\t\t\t\t\t\tpathTimes: pathTimes,\n\t\t\t\t\t\t\tpath: path\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.setState( ( state ) => ( { polylineTimes: [...state.polylineTimes, polyLineTime] } ) );\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Add Marker\n\t\t\t\t\t\tlet marker = {\n\t\t\t\t\t\t\tbuoyId: element.id,\n\t\t\t\t\t\t\tlabel: element.web_display_name,\n\t\t\t\t\t\t\tlat: path[0].lat, // First path lat/lng\n\t\t\t\t\t\t\tlng: path[0].lng, // First path lat/lng\n\t\t\t\t\t\t\tisEnabled: parseInt( element.is_enabled ),\n\t\t\t\t\t\t\tbuoyDownloadText: element.download_text,\n\t\t\t\t\t\t\tdownloadPath: '',\n\t\t\t\t\t\t\tdownloadEnabled: parseInt( element.download_enabled ),\n\t\t\t\t\t\t\tcontent: element.description,\n\t\t\t\t\t\t\tstartDate: element.start_date,\n\t\t\t\t\t\t\tendDate: element.end_date\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.setState( ( state ) => ( { markers: [...state.markers, marker] } ) );\n\n\t\t\t\t\t\t// Polyline markers \n\t\t\t\t\t\tconst newMarkers = [];\n\t\t\t\t\t\t// Start date/time\n\t\t\t\t\t\tconst startDate = new Date( pathTimes[0].time * 1000 )\n\t\t\t\t\t\tlet currentDay = startDate.getDate();\n\t\t\t\t\t\tfor( let n = 0; n < pathTimes.length; n++ ) { \n\t\t\t\t\t\t\tconst pathDate = new Date( pathTimes[n].time * 1000 );\n\t\t\t\t\t\t\tif( currentDay != pathDate.getDate() ) {\n\t\t\t\t\t\t\t\t// Friendly date format\n\t\t\t\t\t\t\t\tcurrentDay = pathDate.getDate();\n\t\t\t\t\t\t\t\tconst day = pathDate.getDate().toString().padStart( 2, \"0\" );\n\t\t\t\t\t\t\t\tconst month = pathDate.getMonth().toString().padStart( 2, \"0\" );\n\t\t\t\t\t\t\t\tlet label = day + '/' + month;\n\n\t\t\t\t\t\t\t\t// Add year for first entry\n\t\t\t\t\t\t\t\tif( newMarkers.length == 0 ) {\n\t\t\t\t\t\t\t\t\tlabel += \"/\" + pathDate.getFullYear();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Add to markers\n\t\t\t\t\t\t\t\tlet driftingMarker = {\n\t\t\t\t\t\t\t\t\tlat: pathTimes[n].lat,\n\t\t\t\t\t\t\t\t\tlng: pathTimes[n].lng,\n\t\t\t\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\t\t\t\tkey: n + 1000,\n\t\t\t\t\t\t\t\t\tisEnabled: parseInt( element.is_enabled )\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tnewMarkers.push( driftingMarker );\n\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.setState( ( state ) => ( { polylineMarkers: [...state.polylineMarkers, ...newMarkers] } ) ); \n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n  }\n\t\t\n\tonMapPolylineClick = ( polyline ) => {\n\t\t// this.initPolylineMarkers( polyline );\n\t\treturn;\n\t}\n\n\tonMapMarkerClick = ( marker ) => {\n\t\tconst { ref } = this.state;\n\t\tif( ref ) {\n\t\t\tconst newCenter = { \n\t\t\t\tlat: parseFloat( marker.position.lat ), \n\t\t\t\tlng: parseFloat( marker.position.lng ) \n\t\t\t};\n\t\t\t\n\t\t\t// Pan to and zoom\n\t\t\tref.panTo( newCenter );\n\t\t\tref.setZoom( 8 );\n\n\t\t\t// Update Chart list position\n\t\t\tthis.props.updateFocus( marker.buoyId );\n\t\t}\n\t}\n\n\tonMapDecommissionedMarkerClick = ( marker ) => {\n\n\t\tconst { ref } = this.state;\n\t\tif( ref ) {\n\t\t\tconst buoyId = marker.buoyId;\n\t\t\tconst end = Date.now() / 1000;\n\t\t\tconst path = \"?action=waf_rest_list_buoy_datapoints_csv&id=\" + buoyId + \"&start=0&end=\" + end;\n\t\t\tconst newCenter = { \n\t\t\t\tlat: parseFloat( marker.position.lat ), \n\t\t\t\tlng: parseFloat( marker.position.lng ) \n\t\t\t};\n\t\t\t\n\t\t\t// Pan to and zoom\n\t\t\tref.panTo( newCenter );\n\t\t\tref.setZoom( 8 );\n\n\t\t\t// Buoy info\n\t\t\t// const infoWindow = <p>Start date:<br />End Date:<br />Download</p>\n\t\n\t\t\tthis.setState( { \n\t\t\t\tinfoWindow: {\n\t\t\t\t\tvisible: true,\n\t\t\t\t\tlat: parseFloat( marker.position.lat ), \n\t\t\t\t\tlng: parseFloat( marker.position.lng ),\n\t\t\t\t\tcontent: marker.description,\n\t\t\t\t\tstartDate: marker.startDate,\n\t\t\t\t\tendDate: marker.endDate\n\t\t\t\t},\n\t\t\t\tdownloadPath: wad.ajax + path,\n\t\t\t\tbuoyDownloadText: marker.buoyDownloadText,\n\t\t\t\tdownloadEnabled: marker.downloadEnabled\n\t\t\t} );\n\t\t}\n\t}\n\n\tonInfoWindowDownload = () => {\n\t\t// Load download lincense modal and hide window\n\t\tthis.setState( {\n\t\t\tbuoyDownloadWindow: true,\n\t\t\tinfoWindow: {\n\t\t\t\tvisible: false,\n\t\t\t\tlat: 0.0, \n\t\t\t\tlng: 0.0,\n\t\t\t\tcontent: ''\n\t\t\t}\n\t\t} );\n\t}\n\n\tonCloseInfoWindow = () => {\n\t\t// Close window and clear download modal data\n\t\tthis.setState( { \n\t\t\tinfoWindow: {\n\t\t\t\tvisible: false,\n\t\t\t\tlat: 0.0, \n\t\t\t\tlng: 0.0,\n\t\t\t\tcontent: ''\n\t\t\t},\n\t\t\tdownloadPath: '',\n\t\t\tbuoyDownloadText: '',\n\t\t\tdownloadEnabled: true\n\t\t} );\n\t}\n\n\tonLoad = ( ref ) => {\n\t\tconst icon = {\n\t\t\turl: wad.plugin + \"images/marker@2x.png\",\n\t\t\tlabelOrigin: new window.google.maps.Point(0, 24),\n\t\t\tscaledSize: new window.google.maps.Size(14,14),\n\t\t\tanchor: new window.google.maps.Point(7,7)\n\t\t};\n\n\t\tconst decommissionedIcon = {\n\t\t\turl: wad.plugin + \"images/marker-decom@2x.png\",\n\t\t\tlabelOrigin: new window.google.maps.Point(0, 24),\n\t\t\tscaledSize: new window.google.maps.Size(14,14),\n\t\t\tanchor: new window.google.maps.Point(7,7)\n\t\t};\n\n\t\tconst labelIcon = {\n\t\t\turl: wad.plugin + \"images/label-marker@2x.png\",\n\t\t\tlabelOrigin: new window.google.maps.Point(0, 20),\n\t\t\tscaledSize: new window.google.maps.Size(8,8),\n\t\t\tanchor: new window.google.maps.Point(4,4)\n\t\t}\n\n\t\tthis.setState( { icon: icon, decommissionedIcon: decommissionedIcon, labelIcon: labelIcon, ref: ref } );\n\t}\n\n\tonBoundsChanged = ( ) => {\n\t\tthis.setBounds( );\n\t}\n\n\tonZoomChanged = ( ) => {\n\t\tconst { ref } = this.state;\n\t\tif( ref ) {\n\t\t\tthis.setState( { currentZoom: ref.getZoom() } );\n\t\t}\n\t}\n\n\tonHistoricChange = ( newState ) => {\n\t\tthis.setState( { historicData: newState.target.checked } );\n\t}\n\t\n\tonLiveChange = ( newState ) => {\n\t\tthis.setState( { liveData: newState.target.checked } );\n\t}\n\n\thandleDownloadClick() {\n    const { downloadPath } = this.state;\n    window.location = downloadPath;\n    this.setState( { downloadPath: '', buoyDownloadText: '', buoyDownloadWindow: false, downloadEnabled: true } );\n  }\n\n  handleModalClose() {\n    this.setState( { downloadPath: '', buoyDownloadText: '', buoyDownloadWindow: false, downloadEnabled: true } );\n  }\n\t\n\tsetBounds = ( ) => {\n\t\t// Set initial bounds\n\t\tsetTimeout( () => {\n\t\t\tconst { boundsSet, initBoundsSet, ref } = this.state;\n\t\t\tif( ref && boundsSet && !initBoundsSet ) {\n\t\t\t\tconst { minLat, minLng, maxLat, maxLng } = this.state;\n\t\t\t\t// Ensure it doesn't happen on resize\n\t\t\t\tthis.setState( () => ( { initBoundsSet: true } ) );\n\t\t\t\t// Set bounds\n\t\t\t\tref.fitBounds( {\n\t\t\t\t\teast: maxLng, \n\t\t\t\t\twest: minLng,\n\t\t\t\t\tnorth: maxLat, \n\t\t\t\t\tsouth: minLat \n\t\t\t\t} );\n\t\t\t}\n\t\t}, 1000 );\n\t}\n\n  render() {\n\t\tconst { center } = this.props;\n\t\tconst { \n\t\t\tmarkers, \n\t\t\tpolylineTimes, \n\t\t\tpolylineMarkers, \n\t\t\ticon, \n\t\t\tlabelIcon, \n\t\t\tdecommissionedIcon, \n\t\t\thistoricData, \n\t\t\tliveData, \n\t\t\tdownloadPath, \n\t\t\tbuoyDownloadWindow,\n\t\t\tbuoyDownloadText, \n\t\t\tdownloadEnabled,\n\t\t\tcurrentZoom,\n\t\t\tinfoWindow\n\t\t} = this.state;\n\n\t\n\t\t// Polylines\n\t\tlet polylines = [];\n\t\tif( polylineTimes ) {\n\t\t\tpolylines = polylineTimes.map( ( marker, i ) => {\n\t\t\t\tif( ( marker.isEnabled !== 1 && !historicData ) || ( marker.isEnabled == 1 && !liveData ) ) {\n\t\t\t\t\t// Hide historic buoys OR hide live buoys\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn <MapPolyline \n\t\t\t\t\tbuoyId={ marker.buoyId } \n\t\t\t\t\tkey={ marker.pathTimes.length } \n\t\t\t\t\tpolylineFocus={ this.onMapPolylineClick }\n\t\t\t\t\tpathTimes={ marker.pathTimes }\n\t\t\t\t\toptions={ {\n\t\t\t\t\t\tpath: marker.path,\n\t\t\t\t\t\tgeodesic: true,\n\t\t\t\t\t\tstrokeColor: \"#FF0000\",\n\t\t\t\t\t\tstrokeOpacity: 1.0,\n\t\t\t\t\t\tstrokeWeight: 2,\n\t\t\t\t\t\tclickable: true\n\t\t\t\t\t} \n\t\t\t\t} />;\n\t\t\t} );\n\t\t}\n\t\t\n\t\t// Show polyline markers when zoom is >= 7\n\t\tlet polylineLabels = [];\n\t\tif( polylineMarkers && currentZoom >= 7 ) {\n\t\t\tpolylineLabels = polylineMarkers.map( ( marker, i ) => {\n\t\t\t\tif( ( marker.isEnabled !== 1 && !historicData ) || ( marker.isEnabled == 1 && !liveData ) ) {\n\t\t\t\t\t// Hide historic buoys OR hide live buoys\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn <Marker \n\t\t\t\t\tposition={ { lat: marker.lat, lng: marker.lng } } \n\t\t\t\t\ticon={ labelIcon } \n\t\t\t\t\tlabel={ { text: marker.label, fontSize: '11px' } } \n\t\t\t\t\tkey={ marker.key } \n\t\t\t\t\tclickable={ false }\n\t\t\t\t/>\n\t\t\t} );\n\t\t}\n\t\t\n\n\t\tlet cluster;\n\t\tif( markers ) {\n\t\t\tcluster = <MarkerClusterer gridSize={ 30 } maxZoom={ 7 }>\n\t\t\t\t{ ( clusterer ) => \n\t\t\t\t\tmarkers.map( ( marker, i ) => {\n\t\t\t\t\t\tif( ( marker.isEnabled !== 1 && !historicData ) || ( marker.isEnabled == 1 && !liveData ) ) {\n\t\t\t\t\t\t\t// Hide historic buoys OR hide live buoys\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<MapMarker \n\t\t\t\t\t\t\t\tbuoyId={ marker.buoyId } \n\t\t\t\t\t\t\t\ticon={ ( marker.isEnabled == 1 ) ? icon : decommissionedIcon } \n\t\t\t\t\t\t\t\tposition={ { lat: marker.lat, lng: marker.lng } } \n\t\t\t\t\t\t\t\tlabel={ { text: marker.label, fontSize: '13px' } } \n\t\t\t\t\t\t\t\tkey={ i } \n\t\t\t\t\t\t\t\tclusterer={ clusterer } \n\t\t\t\t\t\t\t\tmarkerFocus={ (marker.isEnabled == 1 ) ? this.onMapMarkerClick : this.onMapDecommissionedMarkerClick } \n\t\t\t\t\t\t\t\tbuoyDownloadText={ marker.buoyDownloadText }\n\t\t\t\t\t\t\t\tstartDate={ marker.startDate }\n\t\t\t\t\t\t\t\tendDate={ marker.endDate }\n\t\t\t\t\t\t\t\tdescription={ marker.description }\n\t\t\t\t\t\t\t\tdownloadEnabled={ marker.downloadEnabled }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) \n\t\t\t\t\t} )\n\t\t\t\t}\n\t\t\t</MarkerClusterer>\n\t\t}\n\n\t\t// Download popup \n\t\tlet chartModal;\n\t\tif( buoyDownloadWindow ) { // downloadPath.length > 0\n\t\t\tconst ref = React.createRef();\n\t\t\tchartModal = <ChartDownloadModal \n\t\t\t\ttitle=\"Terms and Conditions\"\n\t\t\t\tlicense={ buoyDownloadText }\n\t\t\t\tclose={ this.handleModalClose }\n\t\t\t\tdownload={ this.handleDownloadClick }\n\t\t\t\tdownloadEnabled={ downloadEnabled }\n\t\t\t\tref={ ref }\n\t\t\t/>;\n\t\t}\n\n\t\tlet info = '';\n\t\tif( infoWindow?.visible ) {\n\t\t\tconst sDate = new Date( infoWindow.startDate * 1000 );\n\t\t\tconst eDate = new Date( infoWindow.endDate * 1000 );\n\t\t\t\n\t\t\t// const sDay = sDate.getDate().toString().padStart( 2, \"0\" );\n\t\t\t// const sMonth = sDate.getMonth().toString().padStart( 2, \"0\" );\n\t\t\t// const sYear = sDate.getFullYear().toString();\n\t\t\t// let startLabel = sDay + '/' + sMonth + '/' + sYear;\n\n\n\t\t\tinfo = <InfoWindow\n\t\t\t\tposition={ { lat: infoWindow.lat, lng: infoWindow.lng } }\n\t\t\t\toptions={ { closeBoxURL: '', enableEventPropagation: true } }\n\t\t\t\tonCloseClick={ this.onCloseInfoWindow }\n\t\t\t>\n\t\t\t\t<div style={ { opacity: 1, padding: '6px 12px', backgroundColor: '#ffffff' } }>\n\t\t\t\t\t<div style={ { fontSize: '14px' } }>\n\t\t\t\t\t\t<p>{ infoWindow.content }</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tStart date: { sDate.toDateString() }<br />\n\t\t\t\t\t\t\tEnd date: { eDate.toDateString() }<br />\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<a href=\"#\" onClick={ this.onInfoWindowDownload }>Download Data Archive</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</InfoWindow>;\t\n\t\t}\n\n\t\tlet historicKey = '';\n\t\tif( wad.buoy_display_key == undefined || wad.buoy_display_key == \"1\" ) {\n\t\t\t// Run also if no setting defined\n\t\t\thistoricKey = <div id=\"historic-data\">\n\t\t\t\t<label htmlFor=\"show-historic\">\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tname=\"show-historic\"\n\t\t\t\t\t\tchecked={ historicData }\n\t\t\t\t\t\tonChange={ this.onHistoricChange }\n\t\t\t\t\t\t/>&nbsp;Historical Data\n\t\t\t\t</label>\n\t\t\t\t<label htmlFor=\"show-live\">\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tname=\"show-live\"\n\t\t\t\t\t\tchecked={ liveData }\n\t\t\t\t\t\tonChange={ this.onLiveChange }\n\t\t\t\t\t\t/>&nbsp;Live Data\n\t\t\t\t</label>\n\t\t\t</div>;\n\t\t}\n\n\t\tlet mapRender = <h2>Loading&hellip;</h2>;\n\t\t// Load when markers, zoom and center are defined\n\t\tif( center && currentZoom && markers ) {\n\t\t\tmapRender = <LoadScript\n\t\t\t\tgoogleMapsApiKey={ ( typeof( wad ) != \"undefined\" ) ? wad.googleApiKey : '' }\n\t\t\t>\n\t\t\t\t<GoogleMap\n\t\t\t\t\tmapContainerStyle={ containerStyle }\n\t\t\t\t\tcenter={ center }\n\t\t\t\t\tzoom={ currentZoom }\n\t\t\t\t\toptions={{ styles: mapStyles }}\n\t\t\t\t\tonLoad={ this.onLoad }\n\t\t\t\t\tonBoundsChanged={ this.onBoundsChanged }\n\t\t\t\t\tonZoomChanged={ this.onZoomChanged }\n\t\t\t\t>\n\t\t\t\t\t<>{ info }{ cluster }{ polylines }{ polylineLabels }</>\n\t\t\t\t</GoogleMap>\n\t\t\t\t{ historicKey }\n\t\t\t</LoadScript>;\n\t\t}\n\n    return (\n\t\t\t<div className=\"maps\">\n\t\t\t\t{ chartModal }\n\t\t\t\t{ mapRender }\n\t\t\t</div>\n    )\n  }\n}\n\nconst MapMarker = ( props ) => {\n\tconst onMarkerClick = ( e ) => {\n\t\tprops.markerFocus( { \n\t\t\tbuoyId: props.buoyId,\n\t\t\tposition: props.position,\n\t\t\tbuoyDownloadText: props.buoyDownloadText,\n\t\t\tstartDate: props.startDate,\n\t\t\tendDate: props.endDate, \n\t\t\tdownloadEnabled: props.downloadEnabled,\n\t\t\tdescription: props.description\n\t\t} );\n\t} \n\treturn (\n\t\t<Marker onClick={ onMarkerClick } { ...props }>\n\t\t\t{ props.children }\n\t\t</Marker>\n\t);\n}\n\nconst MapPolyline = ( props ) => {\n\tconst onPolylineClick = ( e ) => {\n\t\tprops.polylineFocus( { buoyId: props.buoyId, pathTimes: props.pathTimes } );\n\t}\n\n\treturn (\n\t\t<Polyline onClick={ onPolylineClick } { ...props } />\n\t)\n}\n","// Charts - React.js\nimport React, { useState, Component, Fragment } from \"react\";\nimport * as ReactDOM from 'react-dom/client';\n\nimport { Charts } from './chart/Chart';\nimport { Map } from './map/Map';\n\nimport \"../scss/bundle.scss\";\n\n\nexport class App extends Component {\n\tconstructor( props ) {\n    super( props );\n\n    this.state = {\n      center: {\n        lat: ( typeof( wad ) != \"undefined\" && 'googleLat' in wad ) ? parseFloat( wad.googleLat ) : 0.0,\n        lng: ( typeof( wad ) != \"undefined\" && 'googleLng' in wad ) ? parseFloat( wad.googleLng ) : 0.0\n      },\n      zoom: ( window.innerWidth < 1200 ) ? 4 : 5,\n      focus: null\n    }\n\n    // Bind this state so buttons state doesn't rise up\n    this.updateMapCenter = this.updateMapCenter.bind( this );\n    this.updateMapZoom = this.updateMapZoom.bind( this );\n    this.updateFocus = this.updateFocus.bind( this );\n  }\n\n  updateMapCenter( newCenter ) {\n    this.setState( { center: newCenter } );\n  }\n  \n  updateMapZoom( newZoom ) {\n    this.setState( { zoom: newZoom } );\n  }\n\n  updateFocus( buoyId ) {\n    this.setState( { focus: buoyId } );\n  }\n\n  render() {\n    const { center, zoom, focus } = this.state;\n    \n    return <>\n      <Map center={ center } zoom={ zoom } updateFocus={ this.updateFocus } />\n      <Charts updateCenter={ this.updateMapCenter } \n              updateZoom={ this.updateMapZoom } \n              buoyFocus={ focus } />\n    </>\n  }\n}\n\ndocument.addEventListener( \"DOMContentLoaded\", function( event ) { \n  if( document.getElementsByClassName('page-template-wave-display-react').length ) {\n    const root = ReactDOM.createRoot( document.getElementById( 'root' ) );\n    root.render(\n      <App/>\n    );\n  }\n\n  // News Message\n  const closeNews = document.querySelector( '.close-me' );\n  if( closeNews ) {\n    closeNews.addEventListener( 'click', ( e ) => { \n      e.preventDefault();\n      const news = document.querySelector( '.recent-news' );\n      if( news ) {\n        news.classList.add( 'collapse-me' );\n      }\n    } );\n  }\n} );\n\n","module.exports = jQuery;"],"sourceRoot":""}